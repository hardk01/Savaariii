(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{2900:(e,n,t)=>{Promise.resolve().then(t.bind(t,1359)),Promise.resolve().then(t.bind(t,3843))},6046:(e,n,t)=>{"use strict";var a=t(6658);t.o(a,"useRouter")&&t.d(n,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(n,{useSearchParams:function(){return a.useSearchParams}})},3843:(e,n,t)=>{"use strict";t.d(n,{default:()=>i});var a=t(5155),o=t(2115),r=t(6046),l=t(7684);let i=()=>{var e;let n,t,i,s;let c=(0,r.useRouter)(),[d,p]=(0,o.useState)(null),[m,u]=(0,o.useState)(null),[h,g]=(0,o.useState)(),[x,b]=(0,o.useState)(""),[y,f]=(0,o.useState)(0),[v,k]=(0,o.useState)(null),[j,w]=(0,o.useState)(null),[N,S]=(0,o.useState)(null);(0,o.useEffect)(()=>{{let e=localStorage.getItem("selectedCarsInfo");if(e){let n=JSON.parse(e);u(n),k(n.price),w(n.price),S(0)}}},[]),(0,o.useEffect)(()=>{{let e=localStorage.getItem("formDataObj");e&&p(JSON.parse(e))}},[]),(0,o.useEffect)(()=>{{let e=localStorage.getItem("userInfoObj");e&&g(JSON.parse(e))}},[]);let C=localStorage.getItem("token");if(C){let e=(0,l.s)(C);console.log("Decoded Token:",e),n=e.userId,t=e.fullName||e.name,i=e.email,s=e.phone}if(!n)return;let P=e=>{f(e),null!==v&&w(e/100*v)},I=async()=>{try{let e=await fetch("".concat("http://192.168.1.7:3000/","v1/coupons/").concat(x));if(!e.ok)throw Error("Invalid coupon code");let n=(await e.json()).data.discount;if(m&&null!==n){let e=m.price*n/100,t=m.price-e;S(e),k(t),w(y/100*t)}}catch(e){console.error("Error applying coupon:",e),m&&(S(0),k(m.price),w(m.price*(y/100)))}},D=()=>new Promise(e=>{let n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>e(!0),n.onerror=()=>e(!1),document.body.appendChild(n)}),z=async e=>{let a={userId:n,bookingType:d.bookingType,totalAmount:m.price,CityRouteFareid:m._id,from:null==m?void 0:m.from,to:null==m?void 0:m.to,pickupdate:null==d?void 0:d.pickUpDate,returnDate:null==d?void 0:d.returnDate,pickuptime:null==d?void 0:d.pickUpTime,pickupAddress:null==d?void 0:d.pickupAddress,dropAddress:null==d?void 0:d.dropAddress,trip:null==d?void 0:d.trip,fullname:t||(null==h?void 0:h.name),email:i||(null==h?void 0:h.email),phoneno:s||(null==h?void 0:h.phoneNumber),pic:null==m?void 0:m.from,drop:null==m?void 0:m.to,status:"pending",paymentMethod:e};try{let e=await fetch("".concat("http://192.168.1.7:3000/","v1/cab-bookings/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(C)},body:JSON.stringify(a)});if(!e.ok)throw Error("Failed to create booking.");let n=await e.json();if(n.data._id)return n.data._id;return console.error("Booking ID (_id) not found in the response."),null}catch(e){return console.error("Error creating booking:",e),null}},E=async()=>{let e=0===y?"cod":"online";if("cod"===e){let n=await z("cod");if(!n){alert("Missing booking ID. Cannot proceed.");return}try{await _(n,e),c.push("/payment-details?bookingId=".concat(n))}catch(e){console.error("Error handling COD booking:",e),alert("Failed to process COD booking. Please try again.")}return}let n=await z("online");if(!n){alert("Missing booking ID. Cannot proceed.");return}let a=await fetch("".concat("http://192.168.1.7:3000/","v1/payments/create-order"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(C)},body:JSON.stringify({bookingId:n,amount:j})});if(!a.ok)throw Error("Failed to create Razorpay order.");let o=(await a.json()).payment.orderId;try{if(!await D()){alert("Failed to load Razorpay SDK. Please try again.");return}let e={key:"rzp_test_eyCE8DA3agdWdo",amount:Math.round(100*j),currency:"INR",name:"Car Payment",description:"Partial or Full Payment",order_id:o,handler:async function(e){let t=e.razorpay_payment_id,a=e.razorpay_order_id,o=e.razorpay_signature;t&&a&&o&&await O(a,t,o,n,"online",e,j)},prefill:{name:t||(null==h?void 0:h.name)||"John Doe",email:i||(null==h?void 0:h.email)||"john.doe@example.com",contact:s||(null==h?void 0:h.phoneNumber)||"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"}},a=new window.Razorpay(e);a.on("payment.failed",function(e){alert("Payment failed! Reason: ".concat(e.error.description))}),a.open()}catch(e){console.error("Unexpected error:",e),alert("Something went wrong. Please try again.")}},_=async(e,n)=>{let t=localStorage.getItem("token");if(e&&n)try{if(!(await fetch("".concat("http://192.168.1.7:3000/","v1/cab-bookings/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({totalAmount:m.price,paymentMethod:n})})).ok)throw Error("Failed to update booking.")}catch(e){console.error("Error updating booking:",e),alert("Failed to update booking. Please try again.")}},O=async(e,n,t,a,o,r,l)=>{let i=localStorage.getItem("token");try{if(!(await fetch("".concat("http://192.168.1.7:3000/","v1/payments/verify"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify({orderId:e,paymentId:n,signature:t,bookingId:a,paymentMethod:o,paymentDetails:r,amount:l})})).ok)throw Error("Payment verification failed.");c.push("/payment-details?bookingId=".concat(a))}catch(e){console.error("Error verifying payment:",e)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("section",{className:"section-cta-6 background-body py-96",children:(0,a.jsxs)("div",{className:"box-cta-6",children:[(0,a.jsx)("div",{className:"container",children:(0,a.jsxs)("div",{className:"row align-items-center",children:[(0,a.jsxs)("div",{className:"col-lg-5",children:[(0,a.jsx)("span",{className:"btn btn-signin bg-2 text-dark mb-4 wow fadeInUp",children:"Payment"}),(0,a.jsxs)("div",{className:"row pt-3 pb-4",children:[(0,a.jsxs)("div",{className:"col-md-5 col-8 d-flex flex-column gap-1",children:[(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Itinerary :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Pickup Date :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Car Type :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"KMs Included :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Initial Price :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Discounted Price :"}),(0,a.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Payable Amount :"})]}),(0,a.jsxs)("div",{className:"col-md-7 col-4 d-flex flex-column gap-1 align-items-end align-items-md-start",children:[(0,a.jsxs)("p",{className:"text-sm-bold neutral-1000",children:[null==d?void 0:d.from," ",">"," ",null==d?void 0:d.to]}),(0,a.jsxs)("p",{className:"text-sm-bold neutral-1000",children:[(null==d?void 0:d.pickUpDate)?(e=>{let n=new Date(e),t=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return"".concat(t,"-").concat(a,"-").concat(o)})(d.pickUpDate):""," "," > "," ",null==d?void 0:d.pickUpTime]}),(0,a.jsx)("p",{className:"text-sm-bold text-primary-dark",children:null==m?void 0:m.selectedCar}),(0,a.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:[null==m?void 0:null===(e=m.distance)||void 0===e?void 0:e.toFixed(0)," km"]}),(0,a.jsxs)("p",{className:"text-sm-bold neutral-1000",children:["₹",null==m?void 0:m.price]}),(0,a.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:["₹",null!==N?N.toFixed(2):"Loading..."]}),(0,a.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:["₹",null!==j?j:"Loading..."]})]})]}),(0,a.jsx)("div",{className:"col-lg-12",children:(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"text-sm-medium neutral-1000",children:"Apply Coupon"}),(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[(0,a.jsx)("input",{value:x,onChange:e=>b(e.target.value),className:"form-control",type:"text",placeholder:"Enter Coupon Code",style:{paddingRight:"2rem"}}),(0,a.jsx)("svg",{onClick:I,width:17,height:16,viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:"#666",cursor:"pointer"},children:(0,a.jsx)("path",{d:"M8.5 15L15.5 8L8.5 1M15.5 8L1.5 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),(0,a.jsx)("div",{className:"col-lg-12",children:(0,a.jsxs)("div",{className:"pricing-options",children:[["0","25","50","100"].map((e,n)=>(0,a.jsxs)("label",{className:"plan-card ".concat(y===Number(e)?"active":""),onClick:()=>P(Number(e)),children:[(0,a.jsx)("input",{type:"radio",name:"plan",value:e,checked:y===Number(e),onChange:()=>P(Number(e))}),(0,a.jsx)("div",{className:"plan-content",children:(0,a.jsxs)("div",{className:"plan-price",children:[(0,a.jsxs)("strong",{children:[e,"%"]})," ",(0,a.jsx)("span",{children:"Pay"})]})})]},n)),(0,a.jsx)("style",{children:'\n          .pricing-options {\n            display: flex;\n            gap: 1rem;\n            padding: 1.5rem 0px;\n            border-radius: 10px;\n            justify-content: center;\n          }\n\n          .plan-card {\n            background: white;\n            border: 1px solid #ddd;\n            border-radius: 10px;\n            padding: 1rem 1.5rem;\n            display: flex;\n            align-items: center;\n            cursor: pointer;\n            transition: box-shadow 0.3s ease, border-color 0.3s ease;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);\n            position: relative;\n          }\n\n          .plan-card:hover {\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          }\n\n          .plan-card input[type="radio"] {\n            appearance: none;\n            -webkit-appearance: none;\n            height: 16px;\n            width: 16px;\n            border: 2px solid #ccc;\n            border-radius: 50%;\n            position: absolute;\n            top: 12px;\n            right: 12px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n          }\n\n          .plan-card input[type="radio"]:checked {\n            border-color: #28a745;\n            background-color: #28a745;\n          }\n\n          .plan-card.active {\n            border-color: #28a745;\n            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);\n          }\n\n          .plan-content {\n            text-align: left;\n          }\n\n          .plan-title {\n            font-weight: bold;\n            margin-bottom: 0.25rem;\n            font-size: 0.9rem;\n            letter-spacing: 0.5px;\n          }\n\n          .plan-price {\n            font-size: 1rem;\n            color: #333;\n          }\n\n          .plan-price strong {\n            font-size: 1.2rem;\n          }\n\n          .plan-price span {\n            color: #888;\n            font-size: 0.9rem;\n}'})]})}),(0,a.jsx)("div",{className:"col-lg-6",children:(0,a.jsxs)("button",{onClick:E,className:"btn btn-book",children:[0===y?"Pay on Delivery":"Proceed to Payment",(0,a.jsx)("svg",{width:17,height:16,viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M8.5 15L15.5 8L8.5 1M15.5 8L1.5 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})})]}),(0,a.jsx)("div",{className:"col-lg-6 offset-lg-1 position-relative z-1 mt-lg-0 mt-4",children:(0,a.jsx)("div",{className:"position-relative",children:(0,a.jsxs)("div",{className:"row align-items-center",children:[(0,a.jsxs)("div",{className:"col-sm-6",children:[(0,a.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-1.png",alt:"Carento"}),(0,a.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-2.png",alt:"Carento"})]}),(0,a.jsxs)("div",{className:"col-sm-6 mt-md-50",children:[(0,a.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-3.png",alt:"Carento"}),(0,a.jsx)("img",{className:"bdrd8 w-100 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-4.png",alt:"Carento"})]})]})})})]})}),(0,a.jsx)("div",{className:"bg-overlay position-absolute bottom-0 end-0 h-75 background-brand-2 opacity-25 z-0 rounded-start-pill"})]})})})}}},e=>{var n=n=>e(e.s=n);e.O(0,[855,660,99,359,441,517,358],()=>n(2900)),_N_E=e.O()}]);