(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{2900:(e,t,a)=>{Promise.resolve().then(a.bind(a,1359)),Promise.resolve().then(a.bind(a,3843))},6046:(e,t,a)=>{"use strict";var n=a(6658);a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}})},3843:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var n=a(5155),o=a(2115),r=a(6046),l=a(7684);let i=()=>{var e;let t=(0,r.useRouter)(),[a,i]=(0,o.useState)(null),[s,c]=(0,o.useState)(null),[d,p]=(0,o.useState)(null),[m,u]=(0,o.useState)(),[g,h]=(0,o.useState)(),[f,x]=(0,o.useState)(""),[y,b]=(0,o.useState)(),[v,k]=(0,o.useState)(0),[w,j]=(0,o.useState)(null),[N,S]=(0,o.useState)(null),[I,C]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=localStorage.getItem("selectedCarsInfo");if(e){let t=JSON.parse(e);c(t),j(t.price),S(t.price),C(0)}},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("userInfoObj");e&&p(JSON.parse(e))},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("selectedCarsInfo"),t=JSON.parse(localStorage.getItem("selectedAllData")||"[]");if(e){let a=JSON.parse(e);if(null==d?void 0:d.email){let e=[...t,{...a,email:d.email}];localStorage.setItem("selectedAllData",JSON.stringify(e))}}},[d]),(0,o.useEffect)(()=>{let e=localStorage.getItem("selectedCarsInfo");e&&c(JSON.parse(e))},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("selectedCarsInfo");e&&u(JSON.parse(e))},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("formDataObj");e&&i(JSON.parse(e))},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("userInfoObj");e&&h(JSON.parse(e))},[]);let P=e=>{k(e),null!==w&&S(e/100*w)},O=async()=>{try{let e=await fetch("".concat("https://api.renttaxi.in/","v1/coupons/").concat(f));if(!e.ok)throw Error("Invalid coupon code");let t=(await e.json()).data.discount;if(s&&null!==t){let e=s.price*t/100,a=s.price-e;C(e),j(a),S(v/100*a)}}catch(e){console.error("Error applying coupon:",e),s&&(C(0),j(s.price),S(s.price*(v/100)))}},E=()=>new Promise(e=>{let t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)}),D=async e=>{let t;let n=localStorage.getItem("token"),o=localStorage.getItem("selectedCarId"),r={initialPrice:s.price,discountedPrice:w,finalPayableAmount:N,couponCode:f,selectedDiscount:v,paymentMethod:e,id:y},i=[...JSON.parse(localStorage.getItem("paymentData")||"[]"),r];if(localStorage.setItem("payment",JSON.stringify(r)),localStorage.setItem("paymentData",JSON.stringify(i)),n&&(t=(0,l.s)(n).userId),!t)return;let c={userId:t,bookingType:a.bookingType,totalAmount:s.price,CityRouteFareid:o,from:null==m?void 0:m.from,to:null==m?void 0:m.to,pickupdate:null==a?void 0:a.pickUpDate,returnDate:null==a?void 0:a.returnDate,pickuptime:null==a?void 0:a.pickUpTime,pickupAddress:null==a?void 0:a.pickupAddress,dropAddress:null==a?void 0:a.dropAddress,trip:null==a?void 0:a.trip,fullname:null==g?void 0:g.name,email:null==g?void 0:g.email,phoneno:null==g?void 0:g.phoneNumber,pic:null==m?void 0:m.from,drop:null==m?void 0:m.to,status:"pending",paymentMethod:e};try{let e=await fetch("".concat("https://api.renttaxi.in/","v1/cab-bookings/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(c)});if(!e.ok)throw Error("Failed to create booking.");let t=await e.json();t.data._id?localStorage.setItem("bookingId",t.data._id):console.error("Booking ID (_id) not found in the response.")}catch(e){console.error("Error creating booking:",e)}},z=async()=>{let e=0===v?"cod":"online";if("cod"===e){await D("cod");let a=localStorage.getItem("bookingId");if(!a){alert("Missing booking ID or payable amount. Cannot proceed.");return}try{await J(a,e),t.push("/payment-details")}catch(e){console.error("Error handling COD booking:",e),alert("Failed to process COD booking. Please try again.")}return}await D("online");let a=localStorage.getItem("token"),n=localStorage.getItem("bookingId"),o=await fetch("".concat("https://api.renttaxi.in/","v1/payments/create-order"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({bookingId:n,amount:N})});if(!o.ok)throw Error("Failed to create Razorpay order.");let r=await o.json();console.log("Razorpay order data:",r);let i=r.payment.orderId;try{let e;let t=localStorage.getItem("token");if(!t||3!==t.split(".").length){alert("Invalid or missing token. Please log in again.");return}try{e=(0,l.s)(t).userId}catch(e){console.error("Error decoding token:",e),alert("Session expired. Please log in again.");return}if(!e){alert("User ID not found in token.");return}if(!await E()){alert("Failed to load Razorpay SDK. Please try again.");return}let a={key:"rzp_test_eyCE8DA3agdWdo",amount:Math.round(100*N),currency:"INR",name:"Car Payment",description:"Partial or Full Payment",order_id:i,handler:async function(e){let t=e.razorpay_payment_id,a=e.razorpay_order_id,n=e.razorpay_signature;if(!t||!a||!n){alert("Payment failed. Please try again.");return}localStorage.setItem("razorpayPaymentId",t),b(t);let o=localStorage.getItem("bookingId");if(!o){alert("Booking ID is missing. Cannot verify payment.");return}await _(a,t,n,o,"online",e,N)},prefill:{name:(null==g?void 0:g.name)||"John Doe",email:(null==g?void 0:g.email)||"john.doe@example.com",contact:(null==g?void 0:g.phoneNumber)||"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"}},n=new window.Razorpay(a);n.on("payment.failed",function(e){alert("Payment failed! Reason: ".concat(e.error.description))}),n.open()}catch(e){console.error("Unexpected error:",e),alert("Something went wrong. Please try again.")}},J=async(e,t)=>{let a=localStorage.getItem("token");if(!e||!t){alert("Missing required fields. Cannot update booking.");return}try{let n=await fetch("".concat("https://api.renttaxi.in/","v1/cab-bookings/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({totalAmount:s.price,paymentMethod:t})});if(!n.ok)throw Error("Failed to update booking.");await n.json()}catch(e){console.error("Error updating booking:",e),alert("Failed to update booking. Please try again.")}},_=async(e,a,n,o,r,l,i)=>{let s=localStorage.getItem("token");try{let c=await fetch("".concat("https://api.renttaxi.in/","v1/payments/verify"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({orderId:e,paymentId:a,signature:n,bookingId:o,paymentMethod:r,paymentDetails:l,amount:i})});if(!c.ok)throw Error("Payment verification failed.");let d=await c.json();console.log("Payment verified successfully:",d),t.push("/payment-details")}catch(e){console.error("Error verifying payment:",e),alert("Payment verification failed. Please contact support.")}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("section",{className:"section-cta-6 background-body py-96",children:(0,n.jsxs)("div",{className:"box-cta-6",children:[(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"row align-items-center",children:[(0,n.jsxs)("div",{className:"col-lg-5",children:[(0,n.jsx)("span",{className:"btn btn-signin bg-2 text-dark mb-4 wow fadeInUp",children:"Payment"}),(0,n.jsxs)("div",{className:"row pt-3 pb-4",children:[(0,n.jsxs)("div",{className:"col-md-5 col-8 d-flex flex-column gap-1",children:[(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Itinerary :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Pickup Date :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Car Type :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"KMs Included :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Initial Price :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Discounted Price :"}),(0,n.jsx)("p",{className:"text-sm-bold neutral-1000",children:"Payable Amount :"})]}),(0,n.jsxs)("div",{className:"col-md-7 col-4 d-flex flex-column gap-1 align-items-end align-items-md-start",children:[(0,n.jsxs)("p",{className:"text-sm-bold neutral-1000",children:[null==a?void 0:a.from," ",">"," ",null==a?void 0:a.to]}),(0,n.jsxs)("p",{className:"text-sm-bold neutral-1000",children:[(null==a?void 0:a.pickUpDate)?(e=>{let t=new Date(e),a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return"".concat(a,"-").concat(n,"-").concat(o)})(a.pickUpDate):""," "," > "," ",null==a?void 0:a.pickUpTime]}),(0,n.jsx)("p",{className:"text-sm-bold text-primary-dark",children:null==s?void 0:s.selectedCar}),(0,n.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:[null==s?void 0:null===(e=s.distance)||void 0===e?void 0:e.toFixed(0)," km"]}),(0,n.jsxs)("p",{className:"text-sm-bold neutral-1000",children:["₹",null==s?void 0:s.price]}),(0,n.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:["₹",null!==I?I.toFixed(2):"Loading..."]}),(0,n.jsxs)("p",{className:"text-sm-bold text-primary-dark",children:["₹",null!==N?N:"Loading..."]})]})]}),(0,n.jsx)("div",{className:"col-lg-12",children:(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"text-sm-medium neutral-1000",children:"Apply Coupon"}),(0,n.jsxs)("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[(0,n.jsx)("input",{value:f,onChange:e=>x(e.target.value),className:"form-control",type:"text",placeholder:"Enter Coupon Code",style:{paddingRight:"2rem"}}),(0,n.jsx)("svg",{onClick:O,width:17,height:16,viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:"#666",cursor:"pointer"},children:(0,n.jsx)("path",{d:"M8.5 15L15.5 8L8.5 1M15.5 8L1.5 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),(0,n.jsx)("div",{className:"col-lg-12",children:(0,n.jsxs)("div",{className:"pricing-options",children:[["0","25","50","100"].map((e,t)=>(0,n.jsxs)("label",{className:"plan-card ".concat(v===Number(e)?"active":""),onClick:()=>P(Number(e)),children:[(0,n.jsx)("input",{type:"radio",name:"plan",value:e,checked:v===Number(e),onChange:()=>P(Number(e))}),(0,n.jsx)("div",{className:"plan-content",children:(0,n.jsxs)("div",{className:"plan-price",children:[(0,n.jsxs)("strong",{children:[e,"%"]})," ",(0,n.jsx)("span",{children:"Pay"})]})})]},t)),(0,n.jsx)("style",{children:'\n          .pricing-options {\n            display: flex;\n            gap: 1rem;\n            padding: 1.5rem 0px;\n            border-radius: 10px;\n            justify-content: center;\n          }\n\n          .plan-card {\n            background: white;\n            border: 1px solid #ddd;\n            border-radius: 10px;\n            padding: 1rem 1.5rem;\n            display: flex;\n            align-items: center;\n            cursor: pointer;\n            transition: box-shadow 0.3s ease, border-color 0.3s ease;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);\n            position: relative;\n          }\n\n          .plan-card:hover {\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          }\n\n          .plan-card input[type="radio"] {\n            appearance: none;\n            -webkit-appearance: none;\n            height: 16px;\n            width: 16px;\n            border: 2px solid #ccc;\n            border-radius: 50%;\n            position: absolute;\n            top: 12px;\n            right: 12px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n          }\n\n          .plan-card input[type="radio"]:checked {\n            border-color: #28a745;\n            background-color: #28a745;\n          }\n\n          .plan-card.active {\n            border-color: #28a745;\n            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);\n          }\n\n          .plan-content {\n            text-align: left;\n          }\n\n          .plan-title {\n            font-weight: bold;\n            margin-bottom: 0.25rem;\n            font-size: 0.9rem;\n            letter-spacing: 0.5px;\n          }\n\n          .plan-price {\n            font-size: 1rem;\n            color: #333;\n          }\n\n          .plan-price strong {\n            font-size: 1.2rem;\n          }\n\n          .plan-price span {\n            color: #888;\n            font-size: 0.9rem;\n}'})]})}),(0,n.jsx)("div",{className:"col-lg-6",children:(0,n.jsxs)("button",{onClick:z,className:"btn btn-book",children:[0===v?"Pay on Delivery":"Proceed to Payment",(0,n.jsx)("svg",{width:17,height:16,viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M8.5 15L15.5 8L8.5 1M15.5 8L1.5 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})})]}),(0,n.jsx)("div",{className:"col-lg-6 offset-lg-1 position-relative z-1 mt-lg-0 mt-4",children:(0,n.jsx)("div",{className:"position-relative",children:(0,n.jsxs)("div",{className:"row align-items-center",children:[(0,n.jsxs)("div",{className:"col-sm-6",children:[(0,n.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-1.png",alt:"Carento"}),(0,n.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-2.png",alt:"Carento"})]}),(0,n.jsxs)("div",{className:"col-sm-6 mt-md-50",children:[(0,n.jsx)("img",{className:"bdrd8 w-100 mb-15 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-3.png",alt:"Carento"}),(0,n.jsx)("img",{className:"bdrd8 w-100 wow fadeInUp",src:"/assets/imgs/cta/cta-6/img-4.png",alt:"Carento"})]})]})})})]})}),(0,n.jsx)("div",{className:"bg-overlay position-absolute bottom-0 end-0 h-75 background-brand-2 opacity-25 z-0 rounded-start-pill"})]})})})}},7684:(e,t,a)=>{"use strict";a.d(t,{s:()=>o});class n extends Error{}function o(e,t){let a;if("string"!=typeof e)throw new n("Invalid token specified: must be a string");t||(t={});let o=!0===t.header?0:1,r=e.split(".")[o];if("string"!=typeof r)throw new n(`Invalid token specified: missing part #${o+1}`);try{a=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var a;return a=t,decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch(e){return atob(t)}}(r)}catch(e){throw new n(`Invalid token specified: invalid base64 for part #${o+1} (${e.message})`)}try{return JSON.parse(a)}catch(e){throw new n(`Invalid token specified: invalid json for part #${o+1} (${e.message})`)}}n.prototype.name="InvalidTokenError"}},e=>{var t=t=>e(e.s=t);e.O(0,[855,503,99,359,441,517,358],()=>t(2900)),_N_E=e.O()}]);